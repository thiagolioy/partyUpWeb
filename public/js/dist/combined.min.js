var PartyUp=PartyUp||function(){var e,t={parseAppId:"5sjv0ulSUoP2jMeLfvblBcfWhAkhQ76bDwRVxnh6",parseRestApiKey:"497ZfHyTwSgrhbnaYSCZiOrS8p3k0HpvtIRrKyXM",parseJsApiKey:"tLOzhEPIJpzTvtQ0SszzwLv1lFC8nsucaePUc7YO",mapsKey:"AIzaSyCjjqEvLoZDIFjlE6CL2z2yTsFYkwfdvKs",initParseSdk:function(){Parse.applicationId||Parse.initialize(this.parseAppId,this.parseJsApiKey)}},a={bindSearchAddress:function(){$("#search-button").click(function(){var e=$("#search-text").val();o.searchInMaps(e)})},bindSelectPlaceImageFileChangeEvent:function(){$("#select-file").bind("change",function(){var e=r.fetchFileFromInput("#select-file");$("#image-name").val(e&&n.isValidImage(e)?e.name:"")})},bindUploadPlaceImageButtonEvent:function(){$("#upload-img-btn").click(function(){$("#select-file").click()})},bindCreatePlaceEvent:function(){$("#create-place-btn").click(function(){var e=r.fetchFileFromInput("#select-file");e?o.createPlace(e):alert("Escolha a imagem primeiro!")})},bindCreatePartyEvent:function(){$("#create-party-btn").click(function(){var e=r.fetchFileFromInput("#select-file");o.createParty(e)})},bindRequestFocusOnDatepicker:function(){$("#datepicker").focus(function(){$("#datepicker").fdatepicker("show")})},bindChangePartyTypeEvent:function(){$("#select-party-list-type").bind("change",function(){var e=$("#select-party-list-type").val();"facebook"==e?($("#facebook-event-id").parent().removeClass("hide"),$("#event-email").parent().addClass("hide")):"email"==e&&($("#event-email").parent().removeClass("hide"),$("#facebook-event-id").parent().addClass("hide"))})},bindChangePartyCityEvent:function(){$("#select-city").bind("change",function(){var e=$("#select-city").val();o.fetchPlaces(e,function(e){var t="<% places.forEach(function(place) { %>            <option value='<%= place.id %>'><%= place.get('name') %></option>          <% }) %>",a=_.template(t);$("#select-place").html(a({places:e}))})})},bindSelectFileEvent:function(){$("#select-file").bind("change",function(){})},bindSavePartyEvent:function(){$("#save-button").click(function(){o.postParty()})},attachEvents:function(){$.each(a,function(e){n.hasIn("bind",e)&&a[e]()})}},n={isValidImage:function(e){var t=n.hasIn(".png",e.name)||n.hasIn(".jpeg",e.name)||n.hasIn(".jpg",e.name);return t?!0:!1},hasIn:function(e,t){return t.indexOf(e)>-1},isValidPlace:function(){return!0},isValidMapsResult:function(e){return e=e||null,null==e?!1:!0},addressFromMapsObj:function(e){var t={},a={street_number:"number",route:"street",neighborhood:"neighborhood",locality:"city",administrative_area_level_1:"state",country:"country",postal_code:"postal_code"};return _.each(e.address_components,function(e){_.each(e.types,function(n){_.contains(Object.keys(a),n)&&(t[a[n]]=e.long_name)})}),t},partyFromInputs:function(){var e=["name","datepicker","hour","description","select-place","facebook-event-id","event-email","male-price","female-price"],t=["name","date","hour","description","placeId","facebookId","eventEmail","malePrice","femalePrice"],a={};return $.each(e,function(e,n){a[t[e]]=$("#"+n).val()}),a}},r={toggleBounceAnimation:function(e,t){t?($(e).removeClass("hide"),$(e).removeClass("animated bounceOutUp"),$(e).addClass("animated bounceInDown")):($(e).removeClass("animated bounceInDown"),$(e).addClass("animated bounceOutUp"),$(e).addClass("hide"))},fetchFileFromInput:function(e){var t=$(e)[0],a=t.files.length>0;return a?t.files[0]:null},updateProgressBar:function(e){var t=Math.round(e.loaded/e.total*100),a=""+t+"%";$("#progressbar-meter").animate({width:a})},updateMaps:function(e,t){{var a=new google.maps.LatLng(e,t),n={center:a,zoom:16},r=new google.maps.Map(document.getElementById("map-canvas"),n);new google.maps.Marker({position:a,map:r,title:"Lugar"})}}},o={createCORSRequest:function(e,t){var a=new XMLHttpRequest;return"withCredentials"in a?a.open(e,t,!0):"undefined"!=typeof XDomainRequest?(a=new XDomainRequest,a.open(e,t)):a=null,a},uploadFile:function(){},searchInMaps:function(a){a=a.replace(/\s/g,"+");var n="https://maps.googleapis.com/maps/api/geocode/json?address="+a+"&key="+t.mapsKey,i=o.createCORSRequest("GET",n);return i?(i.onload=function(){var t=i.responseText,a=jQuery.parseJSON(t);e=a.results[0];var n=e.geometry.location;r.updateMaps(n.lat,n.lng)},i.onerror=function(){alert("Woops, there was an error making the request.")},void i.send()):void alert("CORS not supported")},createPlace:function(a){if(!n.isValidMapsResult(e))return void alert("Busque um endereço primeiro");t.initParseSdk();var r=new Parse.File(a.name,a),o=e.geometry.location,i=new Parse.GeoPoint({latitude:o.lat,longitude:o.lng}),c=n.addressFromMapsObj(e),s=$("#place-name").val(),l=$("#place-complement").val(),u=Parse.Object.extend("Place"),p=new u;return p.set("image",r),p.set("name",s),p.set("canonicalName",s.toUpperCase()),p.set("description",""),p.set("street",c.street),p.set("number",c.number),p.set("neighborhood",c.neighborhood),p.set("city",c.city),p.set("canonicalCity",c.city.toUpperCase()),p.set("state",c.state),p.set("country",c.country),p.set("complement",l),p.set("location",i),n.isValidPlace(p)?void p.save(null,{success:function(){window.location.href="http://partyup.parseapp.com/places"},error:function(e,t){alert("Failed to create new object, with error code: "+t.message)}}):void alert("Por favor , prencha todos os campos obrigatórios")},fetchPlace:function(e,t){if(!e)return void alert("Por favor, escolha uma cidade!");var a=Parse.Object.extend("Place"),n=new Parse.Query(a);n.get(e,{success:function(e){t(e)},error:function(e,t){alert("Failed to retrieve new object, with error code: "+t.message)}})},fetchPlaces:function(e,a){t.initParseSdk();var n=Parse.Object.extend("Place"),r=new Parse.Query(n);r.descending("createdAt"),e&&r.equalTo("canonicalCity",e.toUpperCase()),r.find({success:function(e){a(e)},error:function(e){alert("Error: "+e.code+" "+e.message)}})},createParty:function(e){t.initParseSdk();var a=n.partyFromInputs();o.fetchPlace(a.placeId,function(t){var n=new Parse.File(e.name,e),r=Parse.Object.extend("Party"),o=new r;moment().utcOffset(-180),moment().locale("br");var i=moment(a.date+" "+a.hour,"DD/MM/YYYY HH:mm");o.set("image",n),o.set("name",a.name),o.set("canonicalName",a.name.toUpperCase()),o.set("date",i._d),o.set("description",a.description),o.set("malePrice",a.malePrice),o.set("femalePrice",a.femalePrice),o.set("place",t),a.facebookId?(o.set("sendNamesType","facebook"),o.set("sendNamesTo",a.facebookId)):(o.set("sendNamesType","mail"),o.set("sendNamesTo",a.eventEmail)),o.save(null,{success:function(){window.location.href="http://partyup.parseapp.com/parties"},error:function(e,t){alert("Failed to create new object, with error code: "+t.message)}})})}};return{attachEvents:a.attachEvents}}();$(document).ready(function(){PartyUp.attachEvents()});